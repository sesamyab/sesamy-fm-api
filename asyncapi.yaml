asyncapi: 2.6.0
info:
  title: Podcast Service Events
  version: 1.0.0
  description: CloudEvents published by the Podcast Service

servers:
  development:
    url: localhost
    protocol: cloudEvents
    description: Development environment

channels:
  show.created:
    description: A new podcast show was created
    publish:
      message:
        $ref: "#/components/messages/ShowCreated"

  show.updated:
    description: A podcast show was updated
    publish:
      message:
        $ref: "#/components/messages/ShowUpdated"

  show.deleted:
    description: A podcast show was deleted
    publish:
      message:
        $ref: "#/components/messages/ShowDeleted"

  episode.created:
    description: A new episode was created
    publish:
      message:
        $ref: "#/components/messages/EpisodeCreated"

  episode.updated:
    description: An episode was updated
    publish:
      message:
        $ref: "#/components/messages/EpisodeUpdated"

  episode.deleted:
    description: An episode was deleted
    publish:
      message:
        $ref: "#/components/messages/EpisodeDeleted"

  episode.published:
    description: An episode was published
    publish:
      message:
        $ref: "#/components/messages/EpisodePublished"

  audio.uploaded:
    description: Audio file was uploaded for an episode
    publish:
      message:
        $ref: "#/components/messages/AudioUploaded"

components:
  messages:
    ShowCreated:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ShowEvent"

    ShowUpdated:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ShowEvent"

    ShowDeleted:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ShowDeletedEvent"

    EpisodeCreated:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/EpisodeEvent"

    EpisodeUpdated:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/EpisodeEvent"

    EpisodeDeleted:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/EpisodeDeletedEvent"

    EpisodePublished:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/EpisodeEvent"

    AudioUploaded:
      contentType: application/json
      payload:
        $ref: "#/components/schemas/AudioEvent"

  schemas:
    ShowEvent:
      type: object
      properties:
        specversion:
          type: string
          const: "1.0"
        type:
          type: string
          enum:
            - show.created
            - show.updated
        source:
          type: string
        id:
          type: string
        time:
          type: string
          format: date-time
        subject:
          type: string
        data:
          $ref: "#/components/schemas/Show"
      required:
        - specversion
        - type
        - source
        - id
        - time
        - data

    ShowDeletedEvent:
      type: object
      properties:
        specversion:
          type: string
          const: "1.0"
        type:
          type: string
          const: show.deleted
        source:
          type: string
        id:
          type: string
        time:
          type: string
          format: date-time
        subject:
          type: string
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
          required:
            - id
      required:
        - specversion
        - type
        - source
        - id
        - time
        - data

    EpisodeEvent:
      type: object
      properties:
        specversion:
          type: string
          const: "1.0"
        type:
          type: string
          enum:
            - episode.created
            - episode.updated
            - episode.published
        source:
          type: string
        id:
          type: string
        time:
          type: string
          format: date-time
        subject:
          type: string
        data:
          $ref: "#/components/schemas/Episode"
      required:
        - specversion
        - type
        - source
        - id
        - time
        - data

    EpisodeDeletedEvent:
      type: object
      properties:
        specversion:
          type: string
          const: "1.0"
        type:
          type: string
          const: episode.deleted
        source:
          type: string
        id:
          type: string
        time:
          type: string
          format: date-time
        subject:
          type: string
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
            showId:
              type: string
              format: uuid
          required:
            - id
            - showId
      required:
        - specversion
        - type
        - source
        - id
        - time
        - data

    AudioEvent:
      type: object
      properties:
        specversion:
          type: string
          const: "1.0"
        type:
          type: string
          const: audio.uploaded
        source:
          type: string
        id:
          type: string
        time:
          type: string
          format: date-time
        subject:
          type: string
        data:
          $ref: "#/components/schemas/AudioUpload"
      required:
        - specversion
        - type
        - source
        - id
        - time
        - data

    Show:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        imageUrl:
          type: string
          format: uri
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - title
        - description
        - createdAt
        - updatedAt

    Episode:
      type: object
      properties:
        id:
          type: string
          format: uuid
        showId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        audioUrl:
          type: string
          format: uri
          nullable: true
        published:
          type: boolean
        publishedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - showId
        - title
        - description
        - published
        - createdAt
        - updatedAt

    AudioUpload:
      type: object
      properties:
        id:
          type: string
          format: uuid
        episodeId:
          type: string
          format: uuid
        fileName:
          type: string
        fileSize:
          type: integer
          format: int64
        mimeType:
          type: string
        url:
          type: string
          format: uri
        uploadedAt:
          type: string
          format: date-time
      required:
        - id
        - episodeId
        - fileName
        - fileSize
        - mimeType
        - url
        - uploadedAt
